classdef mbe_toolbox

    properties (Constant)
        tiny      = 1E-4; % precision of atomic coordinates
    end
    
    % pressure related things

    methods (Static)
        
        function P = flux2pressure(J,T,m,th)
            %
            % P = flux2pressure(J,T,m,th) 
            % 
            % J     [atoms/cm^2-s]     flux 
            % P     [Torr]             pressure
            % T     [K]                temperature
            % m     [amu]              mass of atomic species
            % th    [deg]              molecular beam incident angle
            % 
            % Conversion factor 
            %   = 1 / ( cm^2 * s ) * sqrt( K * amu *  boltzman's constant) / Torr
            %   = 1.135674×10^-23 
            %
            % Eq 1 from C. D. Theis, J. Yeh, D. G. Schlom, M. E. Hawley,
            % and G. W. Brown, Thin Solid Films 325, 107 (1998). 
            %
            
            if nargin < 4
                th = 1; % assume normal flux if theta is not supplied
            end
            
            P = J / cosd(th) * sqrt(pi*m*T/8) * 1.135674E-23;
            
        end
        
        function J = pressure2flux(P,T,m,th)
            %
            % J = pressure2flux(P,T,m,th) 
            % 
            % P     [Torr]             pressure
            % J     [atoms/cm^2-s]     flux 
            % T     [K]                temperature
            % m     [amu]              mass of atomic species
            % th    [deg]              molecular beam incident angle
            % 
            % Conversion factor 
            %   = 1 / ( cm^2 * s ) * sqrt( K * amu *  boltzman's constant) / Torr
            %   = 1.135674×10^-23 
            %
            % Eq 1 from C. D. Theis, J. Yeh, D. G. Schlom, M. E. Hawley,
            % and G. W. Brown, Thin Solid Films 325, 107 (1998). 
            %
            
            if nargin < 4
                th = 1; % assume normal flux if theta is not supplied
            end
            
            J = P * cosd(th) / sqrt(pi*m*T/8) / 1.135674E-23;
            
        end
        
        function mfp = pressure2mfp(P,T,sigma)
            %
            % mfp = pressure2mfp(P,T,sigma)
            % 
            % P     [Torr]             pressure
            % T     [K]                temperature
            % sigma [cm^2]             scattering cross-section
            % mfp   [cm]               mean free path
            % 
            % Conversion factor
            %	= Boltzmann's constant * K / ( cm^2 * Torr ) / cm
            %   = 1.03557E-19 
            %
            % Eq 10.1 in A. Rockett, The Materials Science of
            % Semiconductors (Springer Science & Business Media, 2007). 
            %
            
            if nargin < 3 
                sigma = 1E-16; % assume a typical values if sigma is not supplied
            end
            
            mfp = T / ( sqrt(2) * sigma * P ) * 1.03557E-19;
            
        end
        
    end
    
    % periodic table related things
    
    methods (Static)
        
        function [Z]    = symb2Z(symb)
            %
            % Z = symb2Z(symb)
            % 
            % symb  atomic symbol
            % Z     atomic number
            % 
            symbol_database = {...
                 'h'  ,'he' ,'li' ,'be' ,'b'  ,'c'  ,'n'  ,'o'  ,'f'  ,'ne' ,'na' ,'mg' ,'al' ,'si' ,'p'  ,'s'  , ...
                 'cl' ,'ar' ,'k'  ,'ca' ,'sc' ,'ti' ,'v'  ,'cr' ,'mn' ,'fe' ,'co' ,'ni' ,'cu' ,'zn' ,'ga' ,'ge' , ...
                 'as' ,'se' ,'br' ,'kr' ,'rb' ,'sr' ,'y'  ,'zr' ,'nb' ,'mo' ,'tc' ,'ru' ,'rh' ,'pd' ,'ag' ,'cd' , ...
                 'in' ,'sn' ,'sb' ,'te' ,'i'  ,'xe' ,'cs' ,'ba' ,'la' ,'ce' ,'pr' ,'nd' ,'pm' ,'sm' ,'eu' ,'gd' , ...
                 'tb' ,'dy' ,'ho' ,'er' ,'tm' ,'yb' ,'lu' ,'hf' ,'ta' ,'w'  ,'re' ,'os' ,'ir' ,'pt' ,'au' ,'hg' , ...
                 'tl' ,'pb' ,'bi' ,'po' ,'at' ,'rn' ,'fr' ,'ra' ,'ac' ,'th' ,'pa' ,'u'  ,'np' ,'pu' ,'am' ,'cm' , ...
                 'bk' ,'cf' ,'es' ,'fm' ,'md' ,'no' ,'lr' ,'rf' ,'db' ,'sg' ,'bh' ,'hs' ,'mt' ,'ds' ,'rg' ,'uub', ...
                 'uut','uuq','uup','uuh'}; 
             Z = find(strcmp(strtrim(lower(symb)),symbol_database));
        end
        
        function [m]    = Z2mass(Z)
            %
            % m = Z2mass(Z)
            % 
            % Z     atomic number
            % m     atomic mass
            % 
            mass_database = [...
                    1.007947000,     4.002602000,     6.941200000,     9.012182000,    10.811500000, ...
                   12.011100000,    14.006747000,    15.999430000,    18.998403000,    20.179760000, ...
                   22.989769000,    24.305060000,    26.981540000,    28.085530000,    30.973762000, ...
                   32.066600000,    35.452790000,    39.948100000,    39.098310000,    40.078900000, ...
                   44.955911000,    47.883000000,    50.941510000,    51.996160000,    54.938051000, ...
                   55.847300000,    58.933201000,    58.693400000,    63.546300000,    65.392000000, ...
                   69.723100000,    72.612000000,    74.921592000,    78.963000000,    79.904000000, ...
                   83.801000000,    85.467830000,    87.621000000,    88.905852000,    91.224200000, ...
                   92.906382000,    95.941000000,    98.000000000,   101.072000000,   102.905503000, ...
                  106.421000000,   107.868220000,   112.411800000,   114.821000000,   118.710700000, ...
                  121.757000000,   127.603000000,   126.904473000,   131.292000000,   132.905435000, ...
                  137.327700000,   138.905520000,   140.115400000,   140.907653000,   144.243000000, ...
                  145.000000000,   150.363000000,   151.965900000,   157.253000000,   158.925343000, ...
                  162.503000000,   164.930323000,   167.263000000,   168.934213000,   173.043000000, ...
                  174.967100000,   178.492000000,   180.947910000,   183.853000000,   186.207100000, ...
                  190.210000000,   192.223000000,   195.083000000,   196.966543000,   200.593000000, ...
                  204.383320000,   207.210000000,   208.980373000,   209.000000000,   210.000000000, ...
                  222.000000000,   223.000000000,   226.025000000,   227.028000000,   232.038110000, ...
                  231.035900000,   238.028910000,   237.048000000,   244.000000000,   243.000000000, ...
                  247.000000000,   247.000000000,   251.000000000,   252.000000000,   257.000000000, ...
                  258.000000000,   259.000000000,   262.000000000,   261.000000000,   262.000000000, ...
                  263.000000000,   262.000000000,   265.000000000,   266.000000000]; m = mass_database(Z);
        end
        
        function [f0]   = formfactor(Z,th,lambda)
            %
            % f0 = formfactor(Z,th,lambda)
            % 
            % Z      [Z]            atomic number
            % th     [K]            diffaction angle
            % lambda [nm]           x-ray wavelength
            %
            % Atomic form factors are defined as:
            %
            %           4
            %     f0 = sum [ ai*exp(-bi*s^2) ] + c
            %          i=1
            %
            % for s = sin(theta)/lambda and Cromer-Mann coefficients ai,
            % bi, and c. 
            %
            
            CM = Z2cromerman(Z);
            ai = reshape(CM(1:2:7),1,1,[]);
            bi = reshape(CM(2:2:8),1,1,[]);
            f0 = sum( ai .* exp( - bi .* (sind(th)./lambda).^2 ) , 3) + CM(9);
            
        end
        
        function [CM]   = Z2cromerman(Z)
            %
            % CM = Z2cromerman(Z)
            % 
            % Z     atomic number
            % CM    array of Cromer-Mann coefficients [a1, b1, a2, b2, a3, b3, a4, b4, c]
            %
            % S. L. Morelhão, Computer Simulation Tools for X-Ray Analysis
            % (Springer International Publishing, Cham, 2016). 
            %
            
            CM_database = [ ...
               0.489918,  0.262003,  0.196767, 0.049879,20.659300, 7.740390, 49.551900,  2.201590,  0.001305;  % H        
               0.873400,  0.630900,  0.311200, 0.178000, 9.103700, 3.356800, 22.927600,  0.982100,  0.006400;  % He       
               1.128200,  0.750800,  0.617500, 0.465300, 3.954600, 1.052400, 85.390500,168.261000,  0.037700;  % Li       
               1.591900,  1.127800,  0.539100, 0.702900,43.642700, 1.862300,103.483000,  0.542000,  0.038500;  % Be       
               2.054500,  1.332600,  1.097900, 0.706800,23.218500, 1.021000, 60.349800,  0.140300, -0.193200;  % B        
               2.260690,  1.561650,  1.050750, 0.839259,22.690700, 0.656665,  9.756180, 55.594900,  0.286977;  % C        
              12.212600,  3.132200,  2.012500, 1.166300, 0.005700, 9.893300, 28.997500,  0.582600,-11.529000;  % N        
               3.048500,  2.286800,  1.546300, 0.867000,13.277100, 5.701100,  0.323900, 32.908900,  0.250800;  % O        
               3.539200,  2.641200,  1.517000, 1.024300,10.282500, 4.294400,  0.261500, 26.147600,  0.277600;  % F        
               3.955300,  3.112500,  1.454600, 1.125100, 8.404200, 3.426200,  0.230600, 21.718400,  0.351500;  % Ne       
               4.762600,  3.173600,  1.267400, 1.112800, 3.285000, 8.842200,  0.313600,129.424000,  0.676000;  % Na       
               5.420400,  2.173500,  1.226900, 2.307300, 2.827500,79.261100,  0.380800,  7.193700,  0.858400;  % Mg       
               6.420200,  1.900200,  1.593600, 1.964600, 3.038700, 0.742600, 31.547200, 85.088600,  1.115100;  % Al       
               5.662690,  3.071640,  2.624460, 1.393200, 2.665200,38.663400,  0.916946, 93.545800,  1.247070;  % Si       
               6.434500,  4.179100,  1.780000, 1.490800, 1.906700,27.157000,  0.526000, 68.164500,  1.114900;  % P        
               6.905300,  5.203400,  1.437900, 1.586300, 1.467900,22.215100,  0.253600, 56.172000,  0.866900;  % S        
              11.460400,  7.196400,  6.255600, 1.645500, 0.010400, 1.166200, 18.519400, 47.778400, -9.557400;  % Cl       
               7.484500,  6.772300,  0.653900, 1.644200, 0.907200,14.840700, 43.898300, 33.392900,  1.444500;  % Ar       
               8.218600,  7.439800,  1.051900, 0.865900,12.794900, 0.774800,213.187000, 41.684100,  1.422800;  % K        
               8.626600,  7.387300,  1.589900, 1.021100,10.442100, 0.659900, 85.748400,178.437000,  1.375100;  % Ca       
               9.189000,  7.367900,  1.640900, 1.468000, 9.021300, 0.572900,136.108000, 51.353100,  1.332900;  % Sc       
               9.759500,  7.355800,  1.699100, 1.902100, 7.850800, 0.500000, 35.633800,116.105000,  1.280700;  % Ti       
              10.297100,  7.351100,  2.070300, 2.057100, 6.865700, 0.438500, 26.893800,102.478000,  1.219900;  % V        
              10.640600,  7.353700,  3.324000, 1.492200, 6.103800, 0.392000, 20.262600, 98.739900,  1.183200;  % Cr       
              11.281900,  7.357300,  3.019300, 2.244100, 5.340900, 0.343200, 17.867400, 83.754300,  1.089600;  % Mn       
              11.769500,  7.357300,  3.522200, 2.304500, 4.761100, 0.307200, 15.353500, 76.880500,  1.036900;  % Fe       
              12.284100,  7.340900,  4.003400, 2.348800, 4.279100, 0.278400, 13.535900, 71.169200,  1.011800;  % Co       
              12.837600,  7.292000,  4.443800, 2.380000, 3.878500, 0.256500, 12.176300, 66.342100,  1.034100;  % Ni       
              13.338000,  7.167600,  5.615800, 1.673500, 3.582800, 0.247000, 11.396600, 64.812600,  1.191000;  % Cu       
              14.074300,  7.031800,  5.165200, 2.410000, 3.265500, 0.233300, 10.316300, 58.709700,  1.304100;  % Zn       
              15.235400,  6.700600,  4.359100, 2.962300, 3.066900, 0.241200, 10.780500, 61.413500,  1.718900;  % Ga       
              16.081600,  6.374700,  3.706800, 3.683000, 2.850900, 0.251600, 11.446800, 54.762500,  2.131300;  % Ge       
              16.672300,  6.070100,  3.431300, 4.277900, 2.634500, 0.264700, 12.947900, 47.797200,  2.531000;  % As       
              17.000600,  5.819600,  3.973100, 4.354300, 2.409800, 0.272600, 15.237200, 43.816300,  2.840900;  % Se       
              17.178900,  5.235800,  5.637700, 3.985100, 2.172300,16.579600,  0.260900, 41.432800,  2.955700;  % Br       
              17.355500,  6.728600,  5.549300, 3.537500, 1.938400,16.562300,  0.226100, 39.397200,  2.825000;  % Kr       
              17.178400,  9.643500,  5.139900, 1.529200, 1.788800,17.315100,  0.274800,164.934000,  3.487300;  % Rb       
              17.566300,  9.818400,  5.422000, 2.669400, 1.556400,14.098800,  0.166400,132.376000,  2.506400;  % Sr       
              17.776000, 10.294600,  5.726290, 3.265880, 1.402900,12.800600,  0.125599,104.354000,  1.912130;  % Y        
              17.876500, 10.948000,  5.417320, 3.657210, 1.276180,11.916000,  0.117622, 87.662700,  2.069290;  % Zr       
              17.614200, 12.014400,  4.041830, 3.533460, 1.188650,11.766000,  0.204785, 69.795700,  3.755910;  % Nb       
               3.702500, 17.235600, 12.887600, 3.742900, 0.277200, 1.095800, 11.004000, 61.658400,  4.387500;  % Mo       
              19.130100, 11.094800,  4.649010, 2.712630, 0.864132, 8.144870, 21.570700, 86.847200,  5.404280;  % Tc       
              19.267400, 12.918200,  4.863370, 1.567560, 0.808520, 8.434670, 24.799700, 94.292800,  5.378740;  % Ru       
              19.295700, 14.350100,  4.734250, 1.289180, 0.751536, 8.217580, 25.874900, 98.606200,  5.328000;  % Rh       
              19.331900, 15.501700,  5.295370, 0.605844, 0.698655, 7.989290, 25.205200, 76.898600,  5.265930;  % Pd       
              19.280800, 16.688500,  4.804500, 1.046300, 0.644600, 7.472600, 24.660500, 99.815600,  5.179000;  % Ag       
              19.221400, 17.644400,  4.461000, 1.602900, 0.594600, 6.908900, 24.700800, 87.482500,  5.069400;  % Cd       
              19.162400, 18.559600,  4.294800, 2.039600, 0.547600, 6.377600, 25.849900, 92.802900,  4.939100;  % In       
              19.188900, 19.100500,  4.458500, 2.466300, 5.830300, 0.503100, 26.890900, 83.957100,  4.782100;  % Sn       
              19.641800, 19.045500,  5.037100, 2.682700, 5.303400, 0.460700, 27.907400, 75.282500,  4.590900;  % Sb       
              19.964400, 19.013800,  6.144870, 2.523900, 4.817420, 0.420885, 28.528400, 70.840300,  4.352000;  % Te       
              20.147200, 18.994900,  7.513800, 2.273500, 4.347000, 0.381400, 27.766000, 66.877600,  4.071200;  % I        
              20.293300, 19.029800,  8.976700, 1.990000, 3.928200, 0.344000, 26.465900, 64.265800,  3.711800;  % Xe       
              20.389200, 19.106200, 10.662000, 1.495300, 3.569000, 0.310700, 24.387900,213.904000,  3.335200;  % Cs       
              20.336100, 19.297000, 10.888000, 2.695900, 3.216000, 0.275600, 20.207300,167.202000,  2.773100;  % Ba       
              20.578000, 19.599000, 11.372700, 3.287190, 2.948170, 0.244475, 18.772600,133.124000,  2.146780;  % La       
              21.167100, 19.769500, 11.851300, 3.330490, 2.812190, 0.226836, 17.608300,127.113000,  1.862640;  % Ce       
              22.044000, 19.669700, 12.385600, 2.824280, 2.773930, 0.222087, 16.766900,143.644000,  2.058300;  % Pr       
              22.684500, 19.684700, 12.774000, 2.851370, 2.662480, 0.210628, 15.885000,137.903000,  1.984860;  % Nd       
              23.340500, 19.609500, 13.123500, 2.875160, 2.562700, 0.202088, 15.100900,132.721000,  2.028760;  % Pm       
              24.004200, 19.425800, 13.439600, 2.896040, 2.472740, 0.196451, 14.399600,128.007000,  2.209630;  % Sm       
              24.627400, 19.088600, 13.760300, 2.922700, 2.387900, 0.194200, 13.754600,123.174000,  2.574500;  % Eu       
              25.070900, 19.079800, 13.851800, 3.545450, 2.253410, 0.181951, 12.933100,101.398000,  2.419600;  % Gd       
              25.897600, 18.218500, 14.316700, 2.953540, 2.242560, 0.196143, 12.664800,115.362000,  3.583240;  % Tb       
              26.507000, 17.638300, 14.559600, 2.965770, 2.180200, 0.202172, 12.189900,111.874000,  4.297280;  % Dy       
              26.904900, 17.294000, 14.558300, 3.638370, 2.070510, 0.197940, 11.440700, 92.656600,  4.567960;  % Ho       
              27.656300, 16.428500, 14.977900, 2.982330, 2.073560, 0.223545, 11.360400,105.703000,  5.920460;  % Er       
              28.181900, 15.885100, 15.154200, 2.987060, 2.028590, 0.238849, 10.997500,102.961000,  6.756210;  % Tm       
              28.664100, 15.434500, 15.308700, 2.989630, 1.988900, 0.257119, 10.664700,100.417000,  7.566720;  % Yb       
              28.947600, 15.220800, 15.100000, 3.716010, 1.901820, 9.985190,  0.261033, 84.329800,  7.976280;  % Lu       
              29.144000, 15.172600, 14.758600, 4.300130, 1.832620, 9.599900,  0.275116, 72.029000,  8.581540;  % Hf       
              29.202400, 15.229300, 14.513500, 4.764920, 1.773330, 9.370460,  0.295977, 63.364400,  9.243540;  % Ta       
              29.081800, 15.430000, 14.432700, 5.119820, 1.720290, 9.225900,  0.321703, 57.056000,  9.887500;  % W        
              28.762100, 15.718900, 14.556400, 5.441740, 1.671910, 9.092270,  0.350500, 52.086100, 10.472000;  % Re       
              28.189400, 16.155000, 14.930500, 5.675890, 1.629030, 8.979480,  0.382661, 48.164700, 11.000500;  % Os       
              27.304900, 16.729600, 15.611500, 5.833770, 1.592790, 8.865530,  0.417916, 45.001100, 11.472200;  % Ir       
              27.005900, 17.763900, 15.713100, 5.783700, 1.512930, 8.811740,  0.424593, 38.610300, 11.688300;  % Pt       
              16.881900, 18.591300, 25.558200, 5.860000, 0.461100, 8.621600,  1.482600, 36.395600, 12.065800;  % Au       
              20.680900, 19.041700, 21.657500, 5.967600, 0.545000, 8.448400,  1.572900, 38.324600, 12.608900;  % Hg       
              27.544600, 19.158400, 15.538000, 5.525930, 0.655150, 8.707510,  1.963470, 45.814900, 13.174600;  % Tl       
              31.061700, 13.063700, 18.442000, 5.969600, 0.690200, 2.357600,  8.618000, 47.257900, 13.411800;  % Pb       
              33.368900, 12.951000, 16.587700, 6.469200, 0.704000, 2.923800,  8.793700, 48.009300, 13.578200;  % Bi       
              34.672600, 15.473300, 13.113800, 7.025880, 0.700999, 3.550780,  9.556420, 47.004500, 13.677000;  % Po       
              35.316300, 19.021100,  9.498870, 7.425180, 0.685870, 3.974580, 11.382400, 45.471500, 13.710800;  % At       
              35.563100, 21.281600,  8.003700, 7.443300, 0.663100, 4.069100, 14.042200, 44.247300, 13.690500;  % Rn       
              35.929900, 23.054700, 12.143900, 2.112530, 0.646453, 4.176190, 23.105200,150.645000, 13.724700;  % Fr       
              35.763000, 22.906400, 12.473900, 3.210970, 0.616341, 3.871350, 19.988700,142.325000, 13.621100;  % Ra       
              35.659700, 23.103200, 12.597700, 4.086550, 0.589092, 3.651550, 18.599000,117.020000, 13.526600;  % Ac       
              35.564500, 23.421900, 12.747300, 4.807030, 0.563359, 3.462040, 17.830900, 99.172200, 13.431400;  % Th       
              35.884700, 23.294800, 14.189100, 4.172870, 0.547751, 3.415190, 16.923500,105.251000, 13.428700;  % Pa       
              36.022800, 23.412800, 14.949100, 4.188000, 0.529300, 3.325300, 16.092700,100.613000, 13.396600;  % U        
              36.187400, 23.596400, 15.640200, 4.185500, 0.511929, 3.253960, 15.362200, 97.490800, 13.357300;  % Np       
              35.510300, 22.578700, 12.776600, 4.921590, 0.498626, 2.966270, 11.948400, 22.750200, 13.211600;  % Pu       
              36.670600, 24.099200, 17.341500, 3.493310, 0.483629, 3.206470, 14.313600,102.273000, 13.359200;  % Am       
              36.648800, 24.409600, 17.399000, 4.216650, 0.465154, 3.089970, 13.434600, 88.483400, 13.288700;  % Cm       
              36.788100, 24.773600, 17.891900, 4.232840, 0.451018, 3.046190, 12.894600, 86.003000, 13.275400;  % Bk       
              36.918500, 25.199500, 18.331700, 4.243910, 0.437533, 3.007750, 12.404400, 83.788100, 13.267400]; % Cf       
          CM = CM_database(Z,:);

        end
        
    end
    
end








